# README

# <í”„ë¡œì íŠ¸ ì†Œê°œ>

## [ë¹„ëŒ€ë©´ í™”ìƒ íšŒì˜ & ìŠ¤í„°ë”” í”Œë«í¼ "PPAKGOM"]

### :bulb: ê´€ì‹¬ì‚¬ ê²€ìƒ‰ì„ í†µí•´ ì›í•˜ëŠ” ìŠ¤í„°ë””ë¥¼ ë¹ ë¥´ê²Œ ì°¾ê³  ìŠ¤í„°ë””ì› í‰ê°€ë¥¼ í†µí•´ ì—´ì •ì ì¸ ìŠ¤í„°ë””ì›ê³¼ í•¨ê»˜ í•˜ëŠ” í™”ìƒíšŒì˜ ìŠ¤í„°ë”” í”Œë«í¼

##### ì§„í–‰ ê¸°ê°„ : 2021.07.12 ~ 2021.08.20

##### ëª©í‘œ

- ì½”ë¡œë‚˜ë¡œ ì¸í•´ ì˜¤í”„ë¼ì¸ ìŠ¤í„°ë””ê°€ í˜ë“  ì§€ê¸ˆ, ì˜¨ë¼ì¸ìœ¼ë¡œ ìŠ¤í„°ë””ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.
- ê´€ì‹¬ë¶„ì•¼ë¥¼ í†µí•´ ìŠ¤í„°ë””, ìŠ¤í„°ë””ì›ì„ ì°¾ì„ ìˆ˜ ìˆê³  ì—´ì •ë„ë¥¼ ë³´ë©´ì„œ ì¢‹ì€ íŒ€ì›ê³¼ í•¨ê»˜ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ê³µë¶€ë‚˜ ê´€ì‹¬ ë¶„ì•¼ ê³µìœ ë¥¼ í•˜ê³  ì‹¶ì€ ì‚¬ëŒë“¤ ëˆ„êµ¬ë‚˜ ì´ìš©í•  ìˆ˜ ìˆê³  íŠ¹íˆ, ì·¨ì—… ì¤€ë¹„ìƒì˜ ì·¨ë½€ë¥¼ ì‘ì›í•©ë‹ˆë‹¤ğŸ™‚

### :heavy_check_mark: ì£¼ìš” ê¸°ëŠ¥

**ìŠ¤í„°ë”” ê²€ìƒ‰**

![ìŠ¤í„°ë””ê²€ìƒ‰](README.assets/ìŠ¤í„°ë””ê²€ìƒ‰.gif)

**ìŠ¤í„°ë”” ìƒì„±**

![ìŠ¤í„°ë””ìƒì„±](README.assets/ìŠ¤í„°ë””ìƒì„±.gif)

**ìŠ¤í„°ë”” ê°€ì…**

![ìŠ¤í„°ë””ê°€ì…](README.assets/ìŠ¤í„°ë””ê°€ì….gif)

**ìŠ¤í„°ë”” ì¼ì •&ì¶œì„**

![ìŠ¤í„°ë””ì¼ì •&ì¶œì„](README.assets/ìŠ¤í„°ë””ì¼ì •&ì¶œì„.gif)

**ìŠ¤í„°ë”” ì°œí•˜ê¸°**

![ìŠ¤í„°ë””ì°œí•˜ê¸°](README.assets/ìŠ¤í„°ë””ì°œí•˜ê¸°.gif)

**ìŠ¤í„°ë”” ì´ˆëŒ€**

![ìŠ¤í„°ë””ì´ˆëŒ€](README.assets/ìŠ¤í„°ë””ì´ˆëŒ€.gif)

**ìŠ¤í„°ë””ì› í‰ê°€**

![ìŠ¤í„°ë””ì› í‰ê°€](README.assets/ìŠ¤í„°ë””ì› í‰ê°€.gif)

**ë¬¸ì œì§‘ ìƒì„±**

![ë¬¸ì œì§‘ ìƒì„±](README.assets/ë¬¸ì œì§‘ ìƒì„±.gif)

**ë¬¸ì œí’€ê¸°&ê²°ê³¼**

![ë¬¸ì œí’€ê¸°&ê²°ê³¼](README.assets/ë¬¸ì œí’€ê¸°&ê²°ê³¼.gif)

<br>

### ğŸˆ ê¸°íš

##### API ëª…ì„¸ì„œ

- https://confusion-hovercraft-efe.notion.site/29466b85a3c34d4cbf8a2c8a5c8bb4b9?v=14ace7cd5f1549bf924ba899610ac7ef

##### ì™€ì´ì–´ í”„ë ˆì„

- https://confusion-hovercraft-efe.notion.site/c905a398dbb043faab420e725292e31b

**ë°ì´í„°ë² ì´ìŠ¤**

 ![image-20210820012701972](README.assets/image-20210820012701972.png)

<br>

### ğŸ¨ ì•„í‚¤í…ì³

![ì•„í‚¤í…ì³](README.assets/ì•„í‚¤í…ì³.png)

<br>

### :gear: ê°œë°œ í™˜ê²½

#### Frontend

- node v14.17.2
  - https://nodejs.org/es/blog/release/v14.17.2/
- npm 6.14.13
  - https://www.npmjs.com/package/npm/v/6.14.13
- @vue/cli 4.5.13
  - https://www.npmjs.com/package/@vue/cli/v/4.5.13
- VScode Extensions
  - Vetur - Pine Wu
  - EditorConfig for VS Code
  - Vue
  - Vue VSCode Snippets - sarah.drasner

**Project setup**

```plaintext
npm install
```

**Compiles and hot-reloads for development**

```plaintext
npm run serve
```

**Compiles and minifies for production**

```plaintext
npm run build
```

#### Backend

- Java jdk 1.8

  - https://www.eclipse.org/downloads/download.php?file=/technology/epp/downloads/release/2018-09/R/eclipse-jee-2018-09-win32-x86_64.zip

- Gradle

  - https://services.gradle.org/distributions/ -> gradle-6.7-bin.zip

- MySQL 8.0.23
- full distribution on Eclipse 4.15
  - https://github.com/spring-projects/toolsuite-distribution/wiki/Spring-Tool-Suite-3
  - STS 3.9.14.RELEASE
  - ë””íœë˜ì‹œ : Spring Boot DevTools, Lombok,MySQL Driver, QueryDSL, Stomp-WebSocket, Spring Security, JPA, Mail

<br>

#### ë°°í¬

- nginx ì„¤ì¹˜í›„
  /etc/sites-availble/default ë³€ê²½

  -server {
  listen 80 default_server;
  listen [::]:80 default_server;
  server_name i5b306.p.ssafy.io;

            return 301 https://$server_name$request_uri;

  }

server {
listen 443 ssl;
listen [::]:443 ssl;

        root /home/ubuntu/nginx/dist;
        index index.html index.htm index.nginx-debian.html;
    
        server_name i5b306.p.ssafy.io;
    
        ssl_certificate /etc/letsencrypt/live/i5b306.p.ssafy.io/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/i5b306.p.ssafy.io/privkey.pem;
    
        location / {
                try_files $uri $uri/ /index.html;
        }
    
        location /api/v1 {
                proxy_pass https://i5b306.p.ssafy.io:8443;
                proxy_redirect off;
                charset utf-8;
    
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Proto $scheme;
                proxy_set_header X-NginX-Proxy true;
                add_header X-Frame-Options "SAMEORIGIN";
        }


        location /image {
                proxy_pass https://i5b306.p.ssafy.io:8443;
                proxy_redirect off;
                charset utf-8;
    
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Proto $scheme;
                proxy_set_header X-NginX-Proxy true;
        }

}

- docker-compose.yml
  - version: "3.8"
    services:
    db:
    image: mysql:5.7
    container_name: ssafy_db
    restart: always
    command: --lower_case_table_names=1
    ports: - "32000:3306"
    environment:
    MYSQL_ROOT_PASSWORD: root
    TZ: "Asia/Seoul"
    privileged: true
    volumes: - ./db:/docker-entrypoint-initdb.d
    networks: - backend
    app:
    build:
    context: ./
    container_name: ssafy_app
    restart: always
    volumes: - ./image/study:/image/study/ - ./image/user:/image/user/ - ./test:/test/
    ports: - "8080:8080" - "8443:8443"
    environment:
    TZ: "Asia/Seoul"
    SPRING_DATASOURCE_URL: "jdbc:mysql://db:3306/gom?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Seoul&zeroDateTimeBehavior=convertToNull&rewriteBatchedStatements=true"
    server.address: 0.0.0.0
    depends_on: - db
    networks : - backend
    networks:
    backend:
- jar Dockerfile
  - From openjdk:8-jdk-alpine
    VOLUME /tmp
    ARG JAR_FILE=build/libs/\*.jar
    COPY ${JAR_FILE} app.jar
    ENTRYPOINT ["java", "-jar", "/app.jar"]
- db/init.sql
  - create database IF NOT EXISTS gom collate utf8mb4_general_ci;
    create user 'ppakgom'@'%' identified by 'ppakgom';
    grant all privileges on *.*to'ppakgom'@'%';

<br>

# ë°°í¬

## Openvidu deployment

ì°¸ê³  : [openvidu - deployment - On premises](https://docs.openvidu.io/en/2.19.0/deployment/ce/on-premises/)

## Openvidu ì„œë²„ ë°°í¬

> openvidu on promises ë°©ì‹ìœ¼ë¡œ ë°°í¬
>
> ì´ ë°©ì‹ì€ low-levelì— ì†í•˜ëŠ” ì„œë²„ ì„¤ì •(openvidu server, kurento media server, coturn, redis, nginx ë“±ì˜ ì„œë²„ë¥¼ ë„ì»¤ ì»¨í…Œì´ë„ˆë§Œ ê°€ì ¸ì™€ì„œ ë³„ë„ë¡œ ì¶”ê°€ ì„¤ì • ì—†ì´ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ê²ƒ)
>
> docker-composeë¥¼ ì´ìš©í•´ ìœ„ ì„œë²„ë“¤ì´ ì‹¤í–‰ë˜ëŠ” ë„ì»¤ ì»¨í…Œì´ë„ˆë“¤ì„ í†µí•© ê´€ë¦¬
>
> ê¸°ë³¸ì ìœ¼ë¡œ ì•„ë˜ ì„¤ì •ë“¤ì€ ubuntu í™˜ê²½ì—ì„œ ì‹¤í–‰ë¨

- ì ìš©í•˜ë©´ì„œ íŠ¹ì´í–ˆë˜ ì‚¬í•­
  ê¸°ì¡´ì˜ kurento coturnê³¼ ì¶©ëŒì´ ë°œìƒí•´ ì• ë¥¼ ë§ì´ ë¨¹ì—ˆë‹¤.

- Docker ì„¤ì¹˜

  ```bash
  $ sudo apt-get update
  $ sudo apt-get install \
      apt-transport-https \
      ca-certificates \
      curl \
      gnupg \
      lsb-release
  $ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
  $ echo \
    "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \
    $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
  $ sudo apt-get update
  $ sudo apt-get install docker-ce docker-ce-cli containerd.io
  ```

- Docker-Compose ì„¤ì¹˜

  ```bash
  $ sudo curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
  $ sudo chmod +x /usr/local/bin/docker-compose
  ```

- ë³´ì•ˆê·¸ë£¹ ì¸ë°”ìš´ë“œ ì„¤ì •

  - **22 TCP**: to connect using SSH to admin OpenVidu.
  - **80 TCP**: if you select Let's Encrypt to generate an SSL certificate this port is used by the generation process.
  - **443 TCP**: OpenVidu server and application are published by default in standard https port.
  - **3478 TCP+UDP**: used by TURN server to resolve clients IPs.
  - **40000 - 57000 TCP+UDP**: used by Kurento Media Server to establish media connections.
  - **57001 - 65535 TCP+UDP**: used by TURN server to establish relayed media connections.

- Deployment

  - root ê¶Œí•œ ì„¤ì •

    ```bash
    $ sudo su
    ```

  - /opt í´ë”ì— ì„¤ì¹˜ë¥¼ ê¶Œì¥

    ```bash
    $ cd /opt
    ```

  - openvidu ì„¤ì¹˜

    ```bash
    $ curl https://s3-eu-west-1.amazonaws.com/aws.openvidu.io/install_openvidu_latest.sh | bash
    ```

  - configuration

    - /opt/openvidu/.env íŒŒì¼ ìˆ˜ì •(letsencryptë¡œ ìˆ˜ì • ì‹œ)

      - DOMAIN_OR_PUBLIC_IP : ì˜¤í”ˆë°”ì´ë‘ ì„œë²„ê°€ ì‚¬ìš© ê°€ëŠ¥í•œ ë„ë©”ì¸ëª… ë˜ëŠ” public ip
      - CERTIFICATE_TYPE: ì¦ëª…ì„œ íƒ€ì…
      - OPENVIDU_SECRET: dashboard ì…ì¥ ì‹œ ë¡œê·¸ì¸ íŒ¨ìŠ¤ì›Œë“œ(default username: OPENVIDUAPP)
      - LETSENCRYPT_EMAIL : certificate typeì´ letsencryptë¼ë©´ í•´ë‹¹ ì¦ëª…ì„œ ë°œê¸‰ì‹œ ì…ë ¥í•œ ì´ë©”ì¼(ì•„ë‹ˆì—¬ë„ ìƒê´€ì´ ì—†ëŠ” ê²ƒ ê°™ì§€ë§Œ ìœ íš¨í•œ ì´ë©”ì¼ì„ ì ì–´ì•¼ í•¨)

      ```json
      DOMAIN_OR_PUBLIC_IP=i5a306.p.ssafy.io
      
      CERTIFICATE_TYPE=letsencrypt
      
      OPENVIDU_SECRET=GOM_SECRET
      
      LETSENCRYPT_EMAIL=<<ìœ íš¨í•œ ì´ë©”ì¼>>
      ```

  - start

    - /opt/openvidu/ ì—ì„œ ì‹¤í–‰

    ```bash
    $ ./openvidu start
    ```



